{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import Ribbon from\"../components/Ribbon\";import{Link,useNavigate}from\"react-router-dom\";import axios from\"axios\";import{toast}from\"react-toastify\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const Login=()=>{const serverUrl=window.location.origin.includes(\"localhost\")?\"http://localhost:5000\":\"https://khamco-shop-backend.onrender.com\";const[checkMaster,setCheckMaster]=useState(false);const[email,setEmail]=useState(\"\");const[password,setPassword]=useState(\"\");const[passwordType,setPasswordType]=useState(false);const[isPending,setIsPending]=useState(false);const authKey=localStorage.getItem(\"jwt\");const navigate=useNavigate();useEffect(()=>{if(authKey){window.location.replace(\"/\");}document.title=\"Log in to Khamco Shop\";const getLogin=async()=>{await axios.get(\"\".concat(serverUrl,\"/login\")).then(response=>{setCheckMaster(response.data.checkMaster);}).catch(error=>{console.error(error.message);if(error.response){if(error.response.status===403){toast.warn(\"You are not authorized to access that page\");navigate(\"/\");}else{var _error$response$data;toast.error(((_error$response$data=error.response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||error.message);}}else{// Handle network errors or errors without a response object\ntoast.error(\"An error occurred: \"+error.message);}});};return()=>{getLogin();};},[authKey,navigate,serverUrl]);const handleLogin=async event=>{setIsPending(true);event.preventDefault();if(!email||!password){toast.warn(\"Both email and password are required\");setIsPending(false);return;}await axios.post(\"\".concat(serverUrl,\"/login\"),{email:email,password:password}).then(response=>{setIsPending(false);localStorage.setItem(\"jwt\",response.data.jwt);localStorage.setItem(\"session-start\",new Date());if(response.data.userRole===\"tailor\"){navigate(\"/\");}else{navigate(\"/admin/dashboard\");}toast.success(response.data.message);}).catch(error=>{console.error(error);setIsPending(false);if(error.response&&(error.response.status===401||error.response.status===400)){toast.error(\"Login not successful\");}else{toast.error(\"Error logging in\");}});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Ribbon,{}),/*#__PURE__*/_jsx(\"main\",{children:/*#__PURE__*/_jsxs(\"section\",{className:\"p-[4rem] grid justify-center items-center\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"title\",children:\"User Login\"}),/*#__PURE__*/_jsxs(\"form\",{method:\"POST\",className:\"flex flex-col justify-center items-center w-[90vw]\",onSubmit:e=>handleLogin(e),children:[/*#__PURE__*/_jsx(\"div\",{className:\"form-row\"}),checkMaster&&/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsxs(Link,{href:\"/users/create-master\",className:\"alert flash\",children:[\"Click here to register a new\",\" \",/*#__PURE__*/_jsx(\"strong\",{children:\"Master Administrator\"}),\". A user with these privileges has access to all resources.\",\" \",/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-user-plus\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"email\",children:\"Email\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",id:\"email\",name:\"email\",placeholder:\"Enter your email address\",className:\"border focus:border-khamco-secondary\",onChange:e=>setEmail(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-row\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"accept\",children:\"Password\"}),/*#__PURE__*/_jsx(\"input\",{type:passwordType?\"text\":\"password\",name:\"password\",id:\"password\",placeholder:\"Enter your password\",className:\"border focus:border-khamco-secondary\",onChange:e=>setPassword(e.target.value)}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"show-hide\",onClick:()=>setPasswordType(!passwordType),children:/*#__PURE__*/_jsx(\"i\",{className:\"fas \".concat(passwordType?\"fa-eye-slash\":\"fa-eye\")})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center my-[2rem] mx-auto flex-wrap w-full\",children:/*#__PURE__*/_jsx(Link,{to:\"/users/forgot-password\",children:\"Forgotten your password? Reset it now.\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"form-row\",children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:isPending?true:false,children:isPending?/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-rotate animate-spin\"}):\"Submit\"})})]})]})})]});};export default Login;","map":{"version":3,"names":["React","useEffect","useState","Ribbon","Link","useNavigate","axios","toast","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Login","serverUrl","window","location","origin","includes","checkMaster","setCheckMaster","email","setEmail","password","setPassword","passwordType","setPasswordType","isPending","setIsPending","authKey","localStorage","getItem","navigate","replace","document","title","getLogin","get","concat","then","response","data","catch","error","console","message","status","warn","_error$response$data","handleLogin","event","preventDefault","post","setItem","jwt","Date","userRole","success","children","className","method","onSubmit","e","href","htmlFor","type","id","name","placeholder","onChange","target","value","onClick","to","disabled"],"sources":["C:/Users/TawandaMsengezi/Documents/Upwork/Osama-Client/Khamco Shop/Shop-1/client/src/pages/Login.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport Ribbon from \"../components/Ribbon\";\r\nimport { Link, useNavigate } from \"react-router-dom\";\r\nimport axios from \"axios\";\r\nimport { toast } from \"react-toastify\";\r\n\r\nconst Login = () => {\r\n  const serverUrl = window.location.origin.includes(\"localhost\")\r\n    ? \"http://localhost:5000\"\r\n    : \"https://khamco-shop-backend.onrender.com\";\r\n  const [checkMaster, setCheckMaster] = useState(false);\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [passwordType, setPasswordType] = useState(false);\r\n  const [isPending, setIsPending] = useState(false);\r\n  const authKey = localStorage.getItem(\"jwt\");\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    if (authKey) {\r\n      window.location.replace(\"/\");\r\n    }\r\n\r\n    document.title = \"Log in to Khamco Shop\";\r\n\r\n    const getLogin = async () => {\r\n      await axios\r\n        .get(`${serverUrl}/login`)\r\n        .then((response) => {\r\n          setCheckMaster(response.data.checkMaster);\r\n        })\r\n        .catch((error) => {\r\n          console.error(error.message);\r\n          if (error.response) {\r\n            if (error.response.status === 403) {\r\n              toast.warn(\"You are not authorized to access that page\");\r\n              navigate(\"/\");\r\n            } else {\r\n              toast.error(error.response.data?.message || error.message);\r\n            }\r\n          } else {\r\n            // Handle network errors or errors without a response object\r\n            toast.error(\"An error occurred: \" + error.message);\r\n          }\r\n        });\r\n    };\r\n\r\n    return () => {\r\n      getLogin();\r\n    };\r\n  }, [authKey, navigate, serverUrl]);\r\n\r\n  const handleLogin = async (event) => {\r\n    setIsPending(true);\r\n    event.preventDefault();\r\n    if (!email || !password) {\r\n      toast.warn(\"Both email and password are required\");\r\n      setIsPending(false);\r\n      return;\r\n    }\r\n    await axios\r\n      .post(`${serverUrl}/login`, {\r\n        email: email,\r\n        password: password,\r\n      })\r\n      .then((response) => {\r\n        setIsPending(false);\r\n        localStorage.setItem(\"jwt\", response.data.jwt);\r\n        localStorage.setItem(\"session-start\", new Date());\r\n        if (response.data.userRole === \"tailor\") {\r\n          navigate(\"/\");\r\n        } else {\r\n          navigate(\"/admin/dashboard\");\r\n        }\r\n        toast.success(response.data.message);\r\n      })\r\n      .catch((error) => {\r\n        console.error(error);\r\n        setIsPending(false);\r\n        if (\r\n          error.response &&\r\n          (error.response.status === 401 || error.response.status === 400)\r\n        ) {\r\n          toast.error(\"Login not successful\");\r\n        } else {\r\n          toast.error(\"Error logging in\");\r\n        }\r\n      });\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Ribbon />\r\n      <main>\r\n        <section className=\"p-[4rem] grid justify-center items-center\">\r\n          <h1 className=\"title\">User Login</h1>\r\n          <form\r\n            method=\"POST\"\r\n            className=\"flex flex-col justify-center items-center w-[90vw]\"\r\n            onSubmit={(e) => handleLogin(e)}\r\n          >\r\n            <div className=\"form-row\"></div>\r\n            {checkMaster && (\r\n              <div className=\"form-row\">\r\n                <Link href=\"/users/create-master\" className=\"alert flash\">\r\n                  Click here to register a new{\" \"}\r\n                  <strong>Master Administrator</strong>. A user with these\r\n                  privileges has access to all resources.{\" \"}\r\n                  <i className=\"fas fa-user-plus\"></i>\r\n                </Link>\r\n              </div>\r\n            )}\r\n            <div className=\"form-row\">\r\n              <label htmlFor=\"email\">Email</label>\r\n              <input\r\n                type=\"email\"\r\n                id=\"email\"\r\n                name=\"email\"\r\n                placeholder=\"Enter your email address\"\r\n                className=\"border focus:border-khamco-secondary\"\r\n                onChange={(e) => setEmail(e.target.value)}\r\n              ></input>\r\n            </div>\r\n            <div className=\"form-row\">\r\n              <label htmlFor=\"accept\">Password</label>\r\n              <input\r\n                type={passwordType ? \"text\" : \"password\"}\r\n                name=\"password\"\r\n                id=\"password\"\r\n                placeholder=\"Enter your password\"\r\n                className=\"border focus:border-khamco-secondary\"\r\n                onChange={(e) => setPassword(e.target.value)}\r\n              />\r\n              <button\r\n                type=\"button\"\r\n                className=\"show-hide\"\r\n                onClick={() => setPasswordType(!passwordType)}\r\n              >\r\n                <i\r\n                  className={`fas ${passwordType ? \"fa-eye-slash\" : \"fa-eye\"}`}\r\n                ></i>\r\n              </button>\r\n            </div>\r\n            <div className=\"flex justify-center items-center my-[2rem] mx-auto flex-wrap w-full\">\r\n              <Link to=\"/users/forgot-password\">\r\n                Forgotten your password? Reset it now.\r\n              </Link>\r\n            </div>\r\n            <div className=\"form-row\">\r\n              <button type=\"submit\" disabled={isPending ? true : false}>\r\n                {isPending ? (\r\n                  <i className=\"fas fa-rotate animate-spin\"></i>\r\n                ) : (\r\n                  \"Submit\"\r\n                )}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </section>\r\n      </main>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Login;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}